<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TractStack SysOp</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="app.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
       :root {
           --color-bg: #000000;
           --color-bg-sidebar: #181825; /* Catppuccin Mantle */
           --color-text-main: #cdd6f4; /* Catppuccin Text */
           --color-text-dim: #a6adc8;  /* Catppuccin Subtext0 */
           --color-cyan: #89dceb;      /* Catppuccin Sky - Medium */
           --color-cyan-dim: #458592;  /* Catppuccin Sky - Light */
           --color-cyan-bright: #99e3f0; /* Catppuccin Sky - Bright */
           --color-cyan-ultra: #b8f2ff; /* NEW: Catppuccin Sky - Ultra */
           --color-logo: rgba(200, 223, 140, 0.85);
           --color-purple: #cba6f7;    /* Catppuccin Mauve - Medium */
           --color-purple-dim: #8c73aa;  /* Catppuccin Mauve - Light */
           --color-purple-bright: #ddb8ff; /* Catppuccin Mauve - Bright */
           --color-purple-ultra: #e7c7ff;  /* NEW: Catppuccin Mauve - Ultra */
           --color-green: #c8df8c;      /* Your Brand Green */
           --color-yellow: #f9e2af;    /* Catppuccin Yellow */
           --color-red: #f38ba8;        /* Catppuccin Red */
           --color-orange: #fab387;    /* Catppuccin Peach */
           --color-white-bright: #ffffff;
           --color-lead-bright: #fcfcfc;
           --color-lead-medium: #9399b2; /* Catppuccin Overlay2 */
           --color-lead-light: #7f849c;  /* Catppuccin Overlay1 */ 
       }
       [x-cloak] { display: none !important; }
       * { margin: 0; padding: 0; box-sizing: border-box; }
       body { font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace; background: var(--color-bg); color: var(--color-text-main); font-size: 14px; line-height: 1.4; overflow-x: hidden; min-height: 100vh; }
       pre { font-family: inherit; white-space: pre; }
       .bbs-container { display: flex; flex-direction: column; min-height: 100vh; }
       .logo-bar { text-align: center; padding-top: 20px; padding-bottom: 5px; }
       .logo-bar pre.logo { padding: 0; margin: 0; color: var(--color-logo); font-size: 18px; line-height: 1.2; letter-spacing: -1px; }
       .attribution { color: var(--color-text-dim); font-size: 11px; margin-top: 5px; padding-bottom: 10px; }
       .main-area { display: flex; flex: 1; padding: 0 20px; }
       .sidebar { width: 200px; padding: 15px 10px; }
       .tab-menu { color: var(--color-cyan-dim); font-weight: bold; margin-bottom: 10px; }
       .tab-item { color: var(--color-text-dim); cursor: pointer; padding: 4px 0; transition: color 0.2s; }
       .tab-item:hover { color: var(--color-cyan); }
       .tab-item.active { color: var(--color-cyan-bright); font-weight: bold; }
       .content-area { flex: 1; padding: 15px; overflow-y: auto; }
       .bbs-art-background { background-color: #10120d; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAABNJREFUCB1jZGD4z8DAwMiAAwA1NQECJvJSOwAAAABJRU5ErkJggg=='); background-repeat: repeat; }
       .dashboard-header { margin-bottom: 20px; padding-bottom: 5px; border-bottom: 1px solid var(--color-text-dim); }
       .dashboard-header .header-label { color: var(--color-cyan-dim); }
       .dashboard-header .header-highlight { color: var(--color-cyan); }
       .status-section { margin-bottom: 25px; }
       .section-title { color: var(--color-cyan-dim); text-transform: uppercase; margin-bottom: 8px; }
       .metrics-table { color: var(--color-text-main); line-height: 1.6; }
       .metrics-wrapper { display: flex; flex-wrap: wrap; gap: 0 1.5em; line-height: 1.6; }
       .metrics-wrapper > span { white-space: pre; }
       .metric-label { color: var(--color-cyan); }
       .metric-value { color: var(--color-cyan-bright); }
       .metric-dim { color: var(--color-text-dim); }
       .activity-label { color: var(--color-purple); }
       .activity-value { color: var(--color-white-bright); }
       
       /* Status Colors - White for positive, yellow for warning */
       .status-primed, .status-warmed { color: var(--color-yellow); }
       .status-ready, .status-online, .status-complete, .status-hot { color: var(--color-white-bright); }
       .status-loading, .status-warming, .status-connecting { color: var(--color-cyan-bright); }
       .status-offline, .status-error, .status-unavailable, .status-cold { color: var(--color-red); }
   
       .status-bar { border-top: 1px solid var(--color-text-dim); padding: 8px 20px; display: flex; justify-content: space-between; font-size: 12px; color: var(--color-text-dim); }
       .status-bar-left { display: flex; gap: 1em; }
       
       /* Login Screen - Cyan Theme */
       .login-screen-wrapper { background: var(--color-bg); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; }
       .login-message { color: var(--color-cyan-dim); margin: 20px 0; font-size: 16px; }
       .login-input { background: transparent; border: 1px solid var(--color-cyan-dim); color: var(--color-cyan-bright); padding: 8px 16px; font-family: inherit; font-size: 14px; margin-right: 10px; width: 250px; }
       .login-input:focus { outline: none; border-color: var(--color-cyan); }
       .sysop-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background: var(--color-bg); border: 1px solid var(--color-purple); color: var(--color-white-bright); padding: 4px 8px; font-family: inherit; font-size: 14px; }
       .sysop-select:focus { outline: none; border-color: var(--color-cyan); }
       .sysop-button { background: transparent; border: none; color: var(--color-cyan); padding: 8px 0; font-family: inherit; font-size: 14px; cursor: pointer; transition: color 0.2s; }
       .sysop-button:hover { color: var(--color-cyan-bright); }
       
       /* Tenant Selection - Bright white for active */
       .tenant-option { color: var(--color-text-dim); padding: 4px 0; cursor: pointer; }
       .tenant-option:hover { color: var(--color-cyan-bright); }
       .tenant-option.active { color: var(--color-white-bright); }
   
       .progress-bar { display: inline-block; background-color: var(--color-text-dim); white-space: pre; }
       .progress-bar-fill { display: inline-block; height: 1em; background-color: var(--color-cyan); color: var(--color-bg); }
       .bbs-table-header { color: var(--color-cyan); border-bottom: 1px solid var(--color-text-dim); padding-bottom: 4px; margin-bottom: 8px; }
       .log-level-grid { display: grid; grid-template-columns: 200px repeat(4, 1fr); gap: 4px 12px; margin-top: 10px; }
       .log-level-channel { color: var(--color-cyan); }
       .log-level-option { cursor: default; color: var(--color-text-dim); }
       .log-level-option.active { color: var(--color-white-bright); font-weight: bold; }
       .session-universe-map { display: flex; flex-wrap: wrap; gap: 4px; padding: 10px; line-height: 1; user-select: none; }
       .session-universe-legend { display: flex; flex-wrap: wrap; gap: 0 1.5em; line-height: 1.6; }
       .session-stats-wrapper { display: flex; flex-wrap: wrap; gap: 0 1.5em; line-height: 1.6; }
   
       /* Lead colors - white spectrum for leads */
       .lead-active-ultra { color: var(--color-white-bright); }
       .lead-active-bright { color: var(--color-lead-bright); }
       .lead-active-medium { color: var(--color-lead-medium); }
       .lead-active-light { color: var(--color-lead-light); }
       .lead-dormant-dim { color: var(--color-text-dim); }
       
       /* Anonymous with beliefs - purple spectrum - FIXED */
       .anonymous-active-ultra-beliefs { color: var(--color-purple-ultra); }
       .anonymous-active-bright-beliefs { color: var(--color-purple-bright); }
       .anonymous-active-medium-beliefs { color: var(--color-purple); }
       .anonymous-active-light-beliefs { color: var(--color-purple-dim); }
       
       /* Anonymous without beliefs - cyan spectrum - FIXED */
       .anonymous-active-ultra { color: var(--color-cyan-ultra); }
       .anonymous-active-bright { color: var(--color-cyan-bright); }
       .anonymous-active-medium { color: var(--color-cyan); }
       .anonymous-active-light { color: var(--color-cyan-dim); }
       
       /* Dormant (unchanged) */
       .anonymous-dormant-dim { color: var(--color-text-dim); }
      
       /* Graph styles */
       .graph-container { background: var(--color-bg); border: 1px solid var(--color-text-dim); border-radius: 4px; min-height: 400px; overflow: hidden; position: relative; }
       .graph-controls { margin-bottom: 15px; }
       .graph-legend { display: flex; flex-wrap: wrap; gap: 1em 2em; margin-top: 15px; padding: 10px; border: 1px solid var(--color-text-dim); border-radius: 4px; }
       .graph-legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; }
       .graph-legend-shape { width: 14px; height: 14px; }
   
       @media (max-width: 820px) { body { font-size: 12px; } .logo-bar pre.logo { font-size: 10px; } .main-area { flex-direction: column; padding: 0 10px;} .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--color-text-dim);} .status-bar { flex-direction: column; gap: 5px; text-align: center; } }
    </style> 
</head>
<body x-data="sysOpApp()">
    <div id="login-screen" x-show="!authenticated" x-cloak>
        <div class="login-screen-wrapper">
            <div class="logo-bar"><pre class="logo">  ▄██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▄▄▄▄▄▄▄██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄
  ██  ██ ██ ▀▀ ██ ██ ▀▀ ██ ██ ▀▀ ██ ▀▀ ██ ██ ▀▀ ██ ██
  ██  ██▀█▄ ██▀██ ██ ▄▄ ██ ▀▀▀██ ██ ██▀██ ██ ▄▄ ██▀█▄
  ██  ██ ██ ██▄██ ██▄██ ██ ██▄██ ██ ██▄██ ██▄██ ██ ██
    ▀▀                   ▀▀       ▀▀             ▀▀ ▀▀▀</pre><div class="attribution">made by At Risk Media</div></div>
            <div id="login-message" class="login-message">Initializing...</div>
            <div id="password-form" style="display: none;"><input type="password" id="password-input" class="login-input" placeholder="Enter SysOp password" /><button id="login-btn" class="sysop-button">[  submit  ]</button></div>
            <div id="no-auth-form" style="display: none;"><button id="enter-btn" class="sysop-button">[  enter system  ]</button></div>
        </div>
    </div>

    <div id="app-wrapper" x-show="authenticated" x-cloak>
        <div class="bbs-container">
            <div class="logo-bar">
                <pre class="logo">  ▄██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▄▄▄▄▄▄▄██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄
  ██  ██ ██ ▀▀ ██ ██ ▀▀ ██ ██ ▀▀ ██ ▀▀ ██ ██ ▀▀ ██ ██
  ██  ██▀█▄ ██▀██ ██ ▄▄ ██ ▀▀▀██ ██ ██▀██ ██ ▄▄ ██▀█▄
  ██  ██ ██ ██▄██ ██▄██ ██ ██▄██ ██ ██▄██ ██▄██ ██ ██
    ▀▀                   ▀▀       ▀▀             ▀▀ ▀▀▀</pre>
                <div class="attribution">made by At Risk Media</div>
            </div>

            <div class="main-area">
                <div class="sidebar">
                    <pre class="tab-menu">SYSOP MENU</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'dashboard' }" @click="switchTab('dashboard')">[ D ] Dashboard</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'graph' }" @click="switchTab('graph')">[ G ] Graph</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'cache' }" @click="switchTab('cache')">[ C ] Cache</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'status' }" @click="switchTab('status')">[ S ] Status</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'analytics' }" @click="switchTab('analytics')">[ A ] Analytics</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'tenants' }" @click="switchTab('tenants')">[ T ] Tenants</pre>
                    <pre class="tab-item" :class="{ 'active': currentTab === 'logs' }" @click="switchTab('logs')">[ L ] Logs</pre>
                </div>

                <div class="content-area bbs-art-background">
                    <div id="tab-dashboard" x-show="currentTab === 'dashboard'" x-cloak>
                        <pre class="dashboard-header"><span class="header-label">SESSION UNIVERSE - </span><span class="header-highlight">TENANT: </span><span x-text="currentTenant"></span><span class="header-label"> - PULSE: </span><span :class="connectionStatusClass" x-text="sessionSocketStatus"></span></pre>
                        <div class="status-section">
                            <pre class="section-title">SESSION MEMORY MAP (<span x-text="sessionDisplayMode"></span>)</pre>
                            <div class="session-universe-map">
                                <template x-if="sessionStates.length === 0">
                                    <pre class="metric-dim">Connecting to session stream...</pre>
                                </template>
                                <template x-for="(state, index) in sessionStates" :key="index">
                                    <span x-text="sessionBlockCharacter(state)" :class="sessionBlockClass(state)" :title="sessionBlockTitle(state)"></span>
                                </template>
                            </div>
                        </div>
                        <div class="status-section">
                            <pre class="section-title">LEGEND</pre>
                            <div class="session-universe-legend">
                                <pre> <span class="lead-active-bright">█</span> Known Lead</pre>
                                <pre><span class="anonymous-active-bright-beliefs">█</span> Active w/Beliefs</pre>
                                <pre><span class="anonymous-active-bright">█</span> Active</pre>
                                <pre><span class="anonymous-dormant-dim">█</span> Dormant</pre>
                            </div>
                        </div>
                        <div class="status-section">
                            <pre class="section-title">STATS</pre>
                            <div class="session-stats-wrapper">
                                <pre>TOTAL: <span class="metric-value" x-text="sessionStats.total || '0'"></span></pre>
                                <pre>| KNOWN: <span class="metric-value" x-text="sessionStats.lead || '0'"></span> (<span x-text="getPercentage(sessionStats.lead, sessionStats.total)"></span>%)</pre>
                                <pre>| W/BELIEFS: <span class="metric-value" x-text="sessionStats.withBeliefs || '0'"></span> (<span x-text="getPercentage(sessionStats.withBeliefs, sessionStats.total)"></span>%)</pre>
                                <pre>| ACTIVE: <span class="metric-value" x-text="sessionStats.active || '0'"></span> (<span x-text="getPercentage(sessionStats.active, sessionStats.total)"></span>%)</pre>
                                <pre>| DORMANT: <span class="metric-value" x-text="sessionStats.dormant || '0'"></span> (<span x-text="getPercentage(sessionStats.dormant, sessionStats.total)"></span>%)</pre>
                            </div>
                        </div>
                    </div>

                    <div id="tab-status" x-show="currentTab === 'status'" x-cloak>
                        <pre class="dashboard-header"><span class="header-label">SYSTEM STATUS - </span><span class="header-highlight">TENANT: </span><span x-text="currentTenant"></span></pre>
                        <div class="status-section"><pre class="section-title">CONNECTION</pre><pre id="connection-status" class="metrics-table">--</pre></div>
                        <div class="status-section"><pre class="section-title">CACHE STATUS</pre><div id="cache-status" class="metrics-wrapper">--</div></div>
                        <div class="status-section"><pre class="section-title">NODES IN CACHE</pre><div id="nodes-in-cache-metrics" class="metrics-wrapper">--</div></div>
                        <div class="status-section"><pre class="section-title">LIVE ACTIVITY</pre><div id="activity-metrics" class="metrics-wrapper">--</div></div>
                        <div class="status-section"><pre class="section-title">ANALYTICS</pre><pre id="analytics-metrics" class="metrics-table">--</pre></div>
                    </div>

                    <div id="tab-cache" x-show="currentTab === 'cache'" x-cloak><pre class="dashboard-header"><span class="header-label">CACHE DETAILS - </span><span class="header-highlight">TENANT: </span><span x-text="currentTenant"></span></pre><div id="cache-detail-table" class="metrics-table">Loading...</div></div>
                    <div id="tab-analytics" x-show="currentTab === 'analytics'" x-cloak><pre class="dashboard-header"><span class="header-label">ANALYTICS - </span><span class="header-highlight">TENANT: </span><span x-text="currentTenant"></span></pre><div id="analytics-detail-table" class="metrics-table">Loading...</div></div>
                    
                    <div id="tab-graph" x-show="currentTab === 'graph'" x-cloak>
                        <pre class="dashboard-header"><span class="header-label">ACTIVITY GRAPH - </span><span class="header-highlight">TENANT: </span><span x-text="currentTenant"></span><span class="header-label"> - LAST HOUR</span></pre>
                        <div class="status-section">
                            <div class="graph-controls">
                                <button class="sysop-button" @click="loadGraphData()">[ refresh graph ]</button>
                                <span class="metric-dim" x-text="graphStatus"></span>
                            </div>
                            <div class="graph-container" id="graph-svg-container"></div>
                            <div class="graph-legend">
                                <template x-for="item in graphLegendItems" :key="item.type">
                                    <div class="graph-legend-item">
                                        <svg class="graph-legend-shape" viewBox="-10 -10 20 20">
                                            <path :d="item.shape" :fill="item.color"></path>
                                        </svg>
                                        <span x-text="item.label"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tab-tenants" x-show="currentTab === 'tenants'" x-cloak>
                        <pre class="dashboard-header">TENANT MANAGEMENT</pre>
                        <div class="status-section">
                            <pre class="section-title">AVAILABLE TENANTS</pre>
                            <template x-for="(tenant, index) in availableTenants" :key="tenant">
                                <pre class="tenant-option" :class="{ 'active': tenant === currentTenant }" @click="switchTenant(tenant)">
                                    <span x-text="`[${index + 1}] ${tenant}`"></span>
                                    <span x-show="tenant === currentTenant" x-text="' (current)'"></span>
                                </pre>
                            </template>
                        </div>
                    </div>
                    
                    <div id="tab-logs" x-show="currentTab === 'logs'" x-cloak>
                        <pre class="dashboard-header"><span class="header-label">SYSTEM LOGS</span></pre>
                        <div class="status-section">
                            <pre class="section-title">LIVE STREAM</pre>
                            <div class="metrics-wrapper" style="margin-bottom: 15px;">
                                <span><span class="metric-label">Stream Status:</span><span :class="connectionStatusClass" x-text="logConnectionStatus">--</span></span>
                                <span><label for="log-channel" class="metric-label">Channel:</label>
                                    <select x-model="logFilters.channel" id="log-channel" class="sysop-select">
                                        <option value="all">all</option><option value="system">system</option><option value="startup">startup</option><option value="shutdown">shutdown</option><option value="auth">auth</option><option value="content">content</option><option value="analytics">analytics</option><option value="cache">cache</option><option value="database">database</option><option value="tenant">tenant</option><option value="sse">sse</option><option value="performance">performance</option><option value="slow-query">slow-query</option>
                                    </select>
                                </span>
                                <span><label for="log-level" class="metric-label">Min Level:</label>
                                    <select x-model="logFilters.level" id="log-level" class="sysop-select">
                                        <option value="DEBUG">Debug</option><option value="INFO">Info</option><option value="WARN">Warn</option><option value="ERROR">Error</option>
                                    </select>
                                </span>
                            </div>
                            <div class="bbs-art-background" style="background: #21252b; height: 40vh; overflow-y: scroll; padding: 10px;" x-ref="logContainer">
                                <template x-for="log in logs" :key="log.timestamp + log.message">
                                    <pre><span class="metric-dim" x-text="log.timestamp.split('T')[1].split('.')[0]"></span> <span :class="logLevelClass(log.level)" x-text="`[${log.level.padEnd(5, ' ')}]`"></span> <span class="metric-label" x-text="`[${log.channel.padEnd(12, ' ')}]`"></span> <span x-text="log.message"></span><template x-if="log.tenantId"><span class="metric-dim" x-text="` (tenant: ${log.tenantId})`"></span></template></pre>
                                </template>
                                <div x-show="logs.length === 0"><pre class="metric-dim">Waiting for log messages...</pre></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-bar-left">
                    <pre>Status: <span :class="connectionStatusClass" x-text="statusBarContent.status">CONNECTING</span></pre>
                    <pre x-show="statusBarContent.details" x-html="statusBarContent.details"></pre>
                </div>
                <pre>TractStack SysOp v1.0</pre>
            </div>
        </div>
    </div>
</body>
</html>
